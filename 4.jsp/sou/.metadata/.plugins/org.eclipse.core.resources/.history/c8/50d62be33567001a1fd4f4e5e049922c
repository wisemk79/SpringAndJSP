<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%
    //Object->Integer->int  =>메모리에서 꺼내오는 소스코드를 줄일 수 있다.
   // int currentPage=(Integer)request.getAttribute("currentPage");//${currentPage}
   // int count=(Integer)request.getAttribute("count"); ${count}
%>
<html>
<head>
<title>게시판</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#e0ffff">
<center><b>글목록(전체 글:${count})</b>
<table width="700">
<tr>
    <td align="right" bgcolor="#b0e0e6">
    <a href="/JspBoard2/writeForm.do">글쓰기</a>
    </td>
</tr>
</table>
<!-- 데이터의 유무 -->
<%
 if(count==0){
%>
<c:if test="${count==0}">
<table border="1" width="700" cellpadding="0" cellspacing="0" align="center">
   <tr>
      <td align="center">게시판에 저장된 글이 없습니다.</td>
   </tr>
</table>
</c:if>
<c:if test="${count >0}">
<%}else {%>
<table border="1" width="700" cellpadding="0" cellspacing="0" align="center"> 
    <tr height="30" bgcolor="#b0e0e6"> 
      <td align="center"  width="50"  >번 호</td> 
      <td align="center"  width="250" >제   목</td> 
      <td align="center"  width="100" >작성자</td>
      <td align="center"  width="150" >작성일</td> 
      <td align="center"  width="50" >조 회</td> 
      <td align="center"  width="100" >IP</td>    
    </tr>
     <!-- 실질적으로 레코드를 출력시켜주는 부분 -->
     <%
         for(int i=0;i<articleList.size();i++){
            BoardDTO article=(BoardDTO)articleList.get(i);//vecList.elementAt(i)
     %>
    
   <tr height="30"><!--하나씩 감소하면서 출력하는 게시물번호  -->
    <td align="center"  width="50" ><%=number--%></td>
    <td  width="250" >
	  <!-- 답벼글인 경우 먼저 답변이미지를 부착시켜주는 코드부분 -->
	  <%
	       int wid=0;//공백을 계산하기위한 변수선언
	       if(article.getRe_level() > 0){ //답변글이라면 1
	    	   wid=7*(article.getRe_level());//7,14,21,,,
	  %>  
	  <img src="images/level.gif" width="<%=wid%>" height="16">
	  <img src="images/re.gif">
	  <% }else { %>
	  <img src="images/level.gif" width="<%=wid%>" height="16"> 
	  <%}  %>         
	  <!-- 글상세보기 num(게시물번호),pageNum(페이지번호)-->
      <a href="content.jsp?num=<%=article.getNum()%>&pageNum=<%=currentPage%>">
            <%=article.getSubject() %></a>
        <% if(article.getReadcount() >=20) {%> 
         <img src="images/hot.gif" border="0"  height="16"> 
        <% } %>
         </td>
    <td align="center"  width="100"> 
       <a href="mailto:<%=article.getEmail()%>"><%=article.getWriter() %></a></td>
    <td align="center"  width="150"><%=sdf.format(article.getReg_date()) %></td>
    <td align="center"  width="50"><%=article.getReadcount() %></td>
    <td align="center" width="100" ><%=article.getIp() %></td>
  </tr>
     <%   } //for %>
</table>
<% }//else %>
<%
    //페이징 처리
    if(count > 0){ //레코드가 한개 이상이라면
    	//1.총페이지 수 구하기
    	//                       122/10=12.2+122%10(1)=>12.2+1.0=13.2=13페이지
    	int pageCount=count/pageSize+(count%pageSize==0?0:1);
    	//2.시작페이지 ->블럭당 페이지수 계산->10(10의 배수,3->3의 배수,6->6의 배수)
    	int startPage=0;
    	if(currentPage%blockSize!=0){//1~9,11~19,21~29(1,2,4,5,7,8)
    		startPage=currentPage/blockSize*blockSize+1;
    	}else{ //10%10 (10,20,30,40~) (3%3)=>딱 떨어지는 경우
    		//               ((10/10)-1)*10+1=1
    		startPage=((currentPage/blockSize)-1)*blockSize+1;
    	}
    	int endPage=startPage+blockSize-1;//1+10-1=10
    	System.out.println("startPage="+startPage+",endPage=>"+endPage);
    	//블럭별로 구분해서 링크걸어서 출력
    	if(endPage >pageCount) endPage=pageCount;//마지막페이지=총페이지수
    	//1)이전블럭-> 11>10,4>3
    	if(startPage>blockSize){ %>
      <a href="list.jsp?pageNum=<%=startPage-blockSize %>">
        [이전]
      </a>
    	<% }
    	//2)현재블럭(1,2,[3]~10,11~)
    	for(int i=startPage;i<=endPage;i++) { %>
      <a href="list.jsp?pageNum=<%=i%>">[<%=i%>]</a>
    <% } 
    	//3)다음블럭
    	if(endPage < pageCount) {%>
      <a href="list.jsp?pageNum=<%=startPage+blockSize %>">
        [다음]
      </a>
    <% 	
    	} //다음블럭의 if
    }//if(count > 0)
%>
</c:if>
</center>
</body>
</html>






